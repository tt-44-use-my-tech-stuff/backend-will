exports.up = async (knex) => {
  await knex.schema
    .createTable("roles", (roles) =>{
      roles.increments("role_id").defaultTo(1)
      roles.string("role_name", 200).notNullable()
    })
    .createTable("categories", (categories) =>{
      categories.increments("category_id")
      categories.string("category_name", 200).notNullable()
    })
    .createTable('users', (users) => {
      users.increments('user_id')
      users.string('username', 200).notNullable().unique()
      users.string('password', 300).notNullable()
      users.timestamps(false, true)
      users.integer("role_id")
        .unsigned()
        .defaultTo(1)
        .references("role_id")
        .inTable("roles")
    })
    .createTable("tech_items", (tech_items) =>{
      tech_items.increments("tech_item_id")
      tech_items.string("tech_item_title", 200).notNullable()
      tech_items.string("tech_item_description", 200).notNullable()
      tech_items.decimal("tech_item_price", 200).notNullable()
      tech_items.integer("min_rental_period", 200).notNullable()
      tech_items.integer("max_rental_period", 200).notNullable()
      tech_items.integer("category_id")
        .unsigned()
        .notNullable()
        .references("category_id")
        .inTable("categories")
      tech_items.integer("owner_id")
        .unsigned()
        .notNullable()
        .references("user_id")
        .inTable("users")
    })
    .createTable("rentals", (rentals) =>{
      rentals.increments("rental_id")
      rentals.integer("rental_period", 200).notNullable()
      rentals.timestamp('created_at').defaultTo(knex.fn.now());
      // rentals.integer("owner_id")
      //   .unsigned()
      //   .notNullable()
      //   .references("user_id")
      //   .inTable("users")
      // rentals.integer("renter_id")
      //   .unsigned()
      //   .notNullable()
      //   .references("user_id")
      //   .inTable("users")
      // rentals.integer("tech_item_id")
      //   .unsigned()
      //   .notNullable()
      //   .references("tech_item_id")
      //   .inTable("tech_items")
    })
}

exports.down = async (knex) => {
  await knex.schema.dropTableIfExists('rentals')
  await knex.schema.dropTableIfExists('tech_items')
  await knex.schema.dropTableIfExists('users')
  await knex.schema.dropTableIfExists('categories')
  await knex.schema.dropTableIfExists('roles')
}
